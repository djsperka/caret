Description: Link libs dynamically
 Build carets internal libraries as shared libs and link dynamically against
 everything else as well. Upstream is not interested in merging this patch.
Author: Michael Hanke <michael.hanke@gmail.com>
Last-Update: 2010-04-08
--- a/caret/caret5.pro
+++ b/caret/caret5.pro
@@ -102,21 +102,19 @@
 
 unix {
    PRE_TARGETDEPS +=  \
-      ../caret_command_operations/libCaretCommandOperations.a \
-	   ../caret_brain_set/libCaretBrainSet.a \
-      ../caret_vtk4_classes/libCaretVtk4Classes.a \
-	   ../caret_files/libCaretFiles.a \
-	   ../caret_uniformize/libCaretUniformize.a \
-	   ../caret_statistics/libCaretStatistics.a \
-	   ../caret_common/libCaretCommon.a \
-	   ../caret_widgets/libCaretWidgets.a      
+      ../caret_command_operations/libCaretCommandOperations.so \
+	   ../caret_brain_set/libCaretBrainSet.so \
+	   ../caret_files/libCaretFiles.so \
+	   ../caret_uniformize/libCaretUniformize.so \
+	   ../caret_statistics/libCaretStatistics.so \
+	   ../caret_common/libCaretCommon.so \
+	   ../caret_widgets/libCaretWidgets.so
 }
 
 unix:!macx {
    LIBS +=  \
       -L../caret_command_operations -lCaretCommandOperations \
 	   -L../caret_brain_set -lCaretBrainSet \
-      -L../caret_vtk4_classes -lCaretVtk4Classes \
 	   -L../caret_files -lCaretFiles \
 	   -L../caret_uniformize -lCaretUniformize \
 	   -L../caret_statistics -lCaretStatistics \
@@ -140,10 +138,7 @@
    # FreeBSD also does not have libdl, but integrates its functions
    # into libc.
    !exists( /etc/rc.conf ) {
-      LIBS += -lvtkjpeg \
-              -lvtkpng \
-              -lvtkexpat \
-              -ldl 
+      LIBS += -ldl
    }       
 
    # for SGI systems
--- a/caret/main.cxx
+++ b/caret/main.cxx
@@ -523,9 +523,9 @@
    //
    // needed for static linking to have JPEG support
    //
-   Q_IMPORT_PLUGIN(qjpeg) //QJpegPlugin)
-   Q_IMPORT_PLUGIN(qgif)  //QGifPlugin)
-   Q_IMPORT_PLUGIN(qtiff) //QTiffPlugin)
+   //Q_IMPORT_PLUGIN(qjpeg) //QJpegPlugin)
+   //Q_IMPORT_PLUGIN(qgif)  //QGifPlugin)
+   //Q_IMPORT_PLUGIN(qtiff) //QTiffPlugin)
 
    //
    // Set the locale to prevent crashes due to non-english date formats
--- a/caret_brain_set/caret_brain_set.pro
+++ b/caret_brain_set/caret_brain_set.pro
@@ -5,6 +5,7 @@
 TARGET       = CaretBrainSet
 CONFIG  += staticlib 
 INCLUDEPATH += .
+LIBS += -L../caret_files -lCaretFiles
 
 include(../caret_qmake_include.pro)
 
--- a/caret_command/caret_command.pro
+++ b/caret_command/caret_command.pro
@@ -80,15 +80,14 @@
 
 unix {
    PRE_TARGETDEPS +=  \
-           ../caret_command_operations/libCaretCommandOperations.a \
-           ../caret_brain_set/libCaretBrainSet.a \
-           ../caret_vtk4_classes/libCaretVtk4Classes.a \
-           ../caret_files/libCaretFiles.a \
-           ../caret_widgets/libCaretWidgets.a \
-           ../caret_uniformize/libCaretUniformize.a \
-           ../caret_statistics/libCaretStatistics.a \
-           ../caret_common/libCaretCommon.a \
-           ../caret_widgets/libCaretWidgets.a
+           ../caret_command_operations/libCaretCommandOperations.so \
+           ../caret_brain_set/libCaretBrainSet.so \
+           ../caret_files/libCaretFiles.so \
+           ../caret_widgets/libCaretWidgets.so \
+           ../caret_uniformize/libCaretUniformize.so \
+           ../caret_statistics/libCaretStatistics.so \
+           ../caret_common/libCaretCommon.so \
+           ../caret_widgets/libCaretWidgets.so
 
 }
 
@@ -96,7 +95,6 @@
    LIBS += \
            -L../caret_command_operations -lCaretCommandOperations \
            -L../caret_brain_set -lCaretBrainSet \
-           -L../caret_vtk4_classes -lCaretVtk4Classes \
            -L../caret_files -lCaretFiles \
            -L../caret_widgets -lCaretWidgets \
 	        -L../caret_uniformize -lCaretUniformize \
@@ -118,10 +116,7 @@
    # FreeBSD also does not have libdl, but integrates its functions
    # into libc.
    !exists( /etc/rc.conf ) {
-      LIBS += -lvtkjpeg \
-              -lvtkpng \
-              -lvtkexpat \
-              -ldl 
+      LIBS += -ldl
    }       
            
    # for SGI systems
--- a/caret_command/main.cxx
+++ b/caret_command/main.cxx
@@ -109,9 +109,9 @@
       //
       // Get image plugins so JPEGs can be loaded
       //
-      Q_IMPORT_PLUGIN(qjpeg) //QJpegPlugin)
-      Q_IMPORT_PLUGIN(qgif)  //QGifPlugin)
-      Q_IMPORT_PLUGIN(qtiff) 
+      //Q_IMPORT_PLUGIN(qjpeg) //QJpegPlugin)
+      //Q_IMPORT_PLUGIN(qgif)  //QGifPlugin)
+      //Q_IMPORT_PLUGIN(qtiff)
       
       //
       // Get all of the available commands
--- a/caret_command_operations/caret_command_operations.pro
+++ b/caret_command_operations/caret_command_operations.pro
@@ -10,6 +10,7 @@
 
 TEMPLATE = lib
 
+LIBS += -L../caret_brain_set -lCaretBrainSet
 
 # Input
 HEADERS += CommandBase.h \
--- a/caret_edit/caret_edit.pro
+++ b/caret_edit/caret_edit.pro
@@ -48,6 +48,8 @@
            -L../caret_files  -lCaretFiles \
            -L../caret_uniformize -lCaretUniformize \
            -L../caret_common  -lCaretCommon \
+           -L../caret_files  -lCaretFiles \
+           -L../caret_command_operations  -lCaretCommandOperations \
            -L../caret_statistics -lCaretStatistics 
 
    # for SGI systems
--- a/caret_files/caret_files.pro
+++ b/caret_files/caret_files.pro
@@ -9,6 +9,12 @@
 
 include(../caret_qmake_include.pro)
 
+LIBS += -lminc2 \
+        -L../caret_uniformize -lCaretUniformize \
+        -L../caret_statistics -lCaretStatistics \
+        -L../caret_common -lCaretCommon \
+        -L../caret_widgets -lCaretWidgets
+
 # Input
 HEADERS += AbstractFile.h \
 	   AfniHeader.h \
--- a/caret_qmake_include.pro
+++ b/caret_qmake_include.pro
@@ -62,7 +62,7 @@
 #
 # if this file exists then QT4 is being used
 #
-exists( $(QTDIR)/include/Qt/qicon.h ) {
+exists( $(QTDIR)/include/qt4/Qt/qicon.h ) {
    DEFINES += CARET_QT4
    QT += network opengl xml
 }
@@ -106,7 +106,6 @@
    DEFINES += HAVE_MINC
    INCLUDEPATH += $$(NETCDF_INC_DIR)
    NETCDF_LIBS = -L$$(NETCDF_LIB_DIR) \
-                 -lminc \
                  -lnetcdf
 
    exists( $(NETCDF_LIB_DIR)/libminc2.a ) {
@@ -160,7 +159,7 @@
    #VTK_LIBS = ../caret_vtk4_classes/debug/libCaretVtk4Classes.a 
 }
 !win32 {
-   VTK_LIBS = ../caret_vtk4_classes/libCaretVtk4Classes.a 
+#  VTK_LIBS = ../caret_vtk4_classes/libCaretVtk4Classes.a
 }
 VTK_LIBS += \
    -L$$(VTK_LIB_DIR) \
@@ -171,11 +170,7 @@
               -lvtkIO \
               -lvtkFiltering \
               -lvtkCommon \
-	      -lvtksys \
-              -lvtkjpeg \
-              -lvtkpng \
-              -lvtkexpat \
-              -lvtkzlib
+              -lvtksys
 
 exists( $(VTK_INC_DIR)/vtkMPEG2Writer.h ) {
     message( "Building WITH MPEG support" )
@@ -388,7 +383,7 @@
    # QWT libraries
    #
    QWT_LIBS = -L$$(QWT_LIB_DIR) \
-         -lqwt 
+         -lqwt-qt4
    LIBS += \
          -ltiff \
          -ljpeg
@@ -402,4 +397,20 @@
    #QMAKE_LFLAGS_RELEASE += -pg
 }
 
+# Debian specific build configuration
+# always perform release build, debug symbols are taken care of in
+# debian/rules
+CONFIG -= debug
+CONFIG += release
+
+# compile all internal static libs as shared libraries instead
+CONFIG(staticlib, plugin|staticlib): {
+	message("Compile as shared library in Debian build.")
+	CONFIG -= staticlib
+	CONFIG *= plugin
+}
+
+# link everything against VTK -- does not hurt as -Wl,--as-needed is
+# used for Debian build
+LIBS *= $$VTK_LIBS
 
--- a/caret_widgets/caret_widgets.pro
+++ b/caret_widgets/caret_widgets.pro
@@ -7,6 +7,8 @@
 INCLUDEPATH += . \
                ../caret_common
 
+LIBS += -L../caret_common -lCaretCommon
+
 include(../caret_qmake_include.pro)
 
 win32 {
